# Roadmap Management Tool

Automation tool for managing **CE VHST Roadmaps** streamlining tasks such as time tracking, LC updates, and interface creation management.

---

## üß© Features

* **Pointage Automation**: Exports collaborator time tracking data to XML format for VBA import
* **LC Update**: Updates all conditional lists (LC) across template and collaborator files
* **Interface Creation**: Automatically generates user Excel interfaces with three processing modes
* **Interface Deletion or Archiving**: Safely remove or archive all user files with timestamped backups
* **Cleanup Missing Collaborators**: Automatically removes interface files for collaborators no longer in the list
* **VBA Integration**: Seamless integration with Excel VBA macros for user-friendly workflows
* **Parallel Processing**: Fast interface creation using multiprocessing (~9s for 51 files)
* **CLI-based**: Fully automatable and compatible with scripts or scheduled tasks
* **Comprehensive Logging**: All operations logged to `.logs/roadmap.log`
* **Executable Build**: Can be packaged as standalone `.exe` for distribution

---

## ‚öôÔ∏è Prerequisites

* **Python 3.11+**
* [**uv**](https://github.com/astral-sh/uv) package manager (recommended) or pip
* **Microsoft Excel** (for VBA integration and file operations)
* **Windows OS** (primary platform, though code may work on other platforms)

---

## üß∞ Installation

### Option 1: Using uv (Recommended)

1. Install `uv` (if not installed yet):

   ```bash
   curl -LsSf https://astral.sh/uv/install.sh | sh
   # Windows PowerShell:
   powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"
   ```

2. Clone or navigate to the project directory:

   ```bash
   cd roadmap_manager
   ```

3. Sync dependencies:

   ```bash
   uv sync
   ```

   This creates a virtual environment and installs required packages automatically.

### Option 2: Using pip

1. Create a virtual environment:

   ```bash
   python -m venv .venv
   ```

2. Activate the virtual environment:

   ```bash
   # Windows
   .venv\Scripts\activate
   
   # Linux/Mac
   source .venv/bin/activate
   ```

3. Install dependencies:

   ```bash
   pip install -e .
   ```

---

## ‚ñ∂Ô∏è Usage

Run the CLI tool using any of the following methods:

### Option 1 ‚Äî via `uv`

```bash
uv run roadmap <command> [options]
```

### Option 2 ‚Äî via virtual environment

```bash
source .venv/bin/activate   # (Windows: .venv\Scripts\activate)
roadmap <command> [options]
```

### Option 3 ‚Äî via executable

If you've built the executable (see [Building Executable](#-building-executable)):

```bash
roadmap.exe <command> [options]
```

---

## üß† Commands & Options

### Global Options

#### Base Directory

```bash
roadmap --basedir [BASEDIR] <command>
```

Specify the base directory path containing roadmap files. If not provided, uses platform-specific default:
- **Windows**: `C:\Users\<MustaphaELKAMILI>\OneDrive - IKOSCONSULTING\test_RM\files`
- **Other**: `/mnt/c/Users/MustaphaELKAMILI/OneDrive - IKOSCONSULTING/test_RM/files`

---

### Available Commands

#### 1. Pointage (Time Tracking Export)

Exports time tracking data from all collaborator Excel files to an XML file that can be imported by VBA macros.

**What it does:**
* Reads data from `POINTAGE` sheet, starting at row 4, columns A-K (11 columns)
* Stops reading when encountering a fully empty row
* Exports to `pointage_output.xml` in the base directory
* Creates empty XML file if no data exists (required for VBA compatibility)
* Skips temporary Excel files (files starting with `~$`)

```bash
roadmap pointage
```

**Output:**

Creates `pointage_output.xml` with structure:
```xml
<?xml version='1.0' encoding='utf-8'?>
<rows>
  <row>
    <col1>value1</col1>
    <col2>value2</col2>
    <col3>value3</col3>
    ...
    <col11>value11</col11>
  </row>
  ...
</rows>
```

**Examples:**

```bash
# Export pointage data from all collaborator files
roadmap pointage

# With custom base directory
roadmap --basedir "C:\MyRoadmapFiles" pointage
```

---

#### 2. Update LC (Conditional Lists)

Synchronizes conditional lists (dropdown options) across all Excel files.

**What it does:**
* Reads LC data from `LC.xlsx` file (generated by VBA `btn_update_LC` button)
* Reads columns B-I (columns 2-9), starting at row 2
* Updates the template file (`RM_template.xlsx`)
* Updates all collaborator interface files in `RM_Collaborateurs` folder
* For collaborator files, recreates data validation lists in POINTAGE sheet (columns D-G)
* Preserves existing data in collaborator files - only LC sheet and data validation are updated
* Clears old data beyond the new data range
* Skips temporary Excel files (files starting with `~$`)

```bash
roadmap update
```

**Prerequisites:**
* `LC.xlsx` file must exist in the base directory (created by VBA button)
* Template and collaborator files must not be open in Excel

**Examples:**

```bash
# Update conditional lists in all files
roadmap update

# With custom base directory
roadmap --basedir "C:\MyRoadmapFiles" update
```

**Note:** The `LC.xlsx` file is automatically deleted after reading to keep the directory clean.

---

#### 3. Create Interfaces

Creates individual Excel interface files for each collaborator listed in the synthesis file.

**What it does:**
* Reads collaborator names from `collabs.xml` file (created by VBA macros)
* Creates `RM_[COLLABORATOR_NAME].xlsx` files in `RM_Collaborateurs` folder
* Sets collaborator name in cell B1 of POINTAGE sheet
* Adds data validation lists for:
  - Column D: Week (from POINTAGE!A2:A2)
  - Column E: Key (from LC!B3:B1000)
  - Column F: Label (from LC!C3:C1000)
  - Column G: Function (from LC!D3:D1000)
* Only creates files that don't already exist (skips existing files)

```bash
roadmap create [--way MODE] [--archive]
```

**Options:**

* `--way MODE` ‚Üí Choose processing mode:
  * `normal` (default): Sequential processing using openpyxl (~50s for 51 files)
  * `para`: Parallel processing using multiprocessing (~9s for 51 files) ‚ö° **Fastest**
  * `xlw`: xlwings-based processing (~3min4s for 51 files) - Best for VBA integration
* `--archive` ‚Üí Archive existing `RM_Collaborateurs` folder before creating new interfaces

**Examples:**

```bash
# Create interfaces using default (normal) mode
roadmap create

# Create interfaces in parallel (fastest)
roadmap create --way para

# Create interfaces and archive existing ones
roadmap create --archive --way para

# Use xlwings mode for better Excel integration
roadmap create --way xlw

# With custom base directory
roadmap --basedir "C:\MyRoadmapFiles" create --way para
```

**Prerequisites:**
* `collabs.xml` file must exist in the base directory (created by VBA macros)
* Template file (`RM_template.xlsx`) must be closed
* For parallel mode, template file must be accessible (not locked)

**Note:** The `collabs.xml` file is automatically deleted after reading to keep the directory clean.

---

#### 4. Delete Interfaces

Removes or archives all collaborator interface files.

**What it does:**
* Moves `RM_Collaborateurs` folder to `Deleted` directory with timestamp
* Optionally archives to `Archived` directory first
* Creates zip archives with timestamped names
* **Requires `--force` flag** to prevent accidental deletion

```bash
roadmap delete [--archive] --force
```

**Options:**

* `--archive` ‚Üí Archives files to `Archived` folder before moving to `Deleted`
* `--force` ‚Üí **Required** to actually perform the operation (safety mechanism)

**Examples:**

```bash
# Archive and delete all files
roadmap delete --archive --force

# Permanently delete all files (no archive)
roadmap delete --force

# Dry run (shows warning, no action taken)
roadmap delete --archive
```

**Archive Structure:**
* If `--archive` is used: `Archived/Archive_RM_Collaborateurs_[timestamp].zip`
* Always creates: `Deleted/Deleted_RM_Collaborateurs_[timestamp].zip`
* Timestamp format: `DDMMYYYY_HHMMSS`

---

#### 5. Cleanup Missing Collaborators

Deletes interface files for collaborators that are missing from the current collaborator list.

**What it does:**
* Compares existing files in `RM_Collaborateurs` folder with collaborator list from `collabs.xml`
* If a file exists but the collaborator is not in the XML list, that file is deleted
* Creates a zip archive of deleted files before deletion
* Skips temporary Excel files (files starting with `~$`)

```bash
roadmap cleanup
```

**Examples:**

```bash
# Remove interfaces for missing collaborators
roadmap cleanup

# With custom base directory
roadmap --basedir "C:\MyRoadmapFiles" cleanup
```

**Prerequisites:**
* `collabs.xml` file must exist in the base directory (created by VBA macros)

**Archive:**
* Creates `Deleted/Deleted_Missing_RM_collaborators_[timestamp].zip` before deletion

---

## üìÅ Project Structure

```text
roadmap_manager/
‚îÇ   .gitignore
‚îÇ   pyproject.toml              # Project configuration & dependencies
‚îÇ   README.md                   # This file
‚îÇ   uv.lock                     # Dependency lock file (uv)
‚îÇ   roadmap_cli.py              # Entry point for PyInstaller builds
‚îÇ   roadmap.spec                # PyInstaller spec file
‚îÇ   build_exe.bat               # Batch script to build executable
‚îÇ   
‚îú‚îÄ‚îÄ‚îÄ.logs/                      # Log directory (created automatically)
‚îÇ       roadmap.log             # Application logs
‚îÇ
‚îú‚îÄ‚îÄ‚îÄroadmap/                    # Main Python package
‚îÇ       __init__.py             # Package initialization
‚îÇ       main.py                 # CLI entry point and argument parsing
‚îÇ       roadmap.py              # RoadmapManager class (core logic)
‚îÇ       helpers.py              # Utility functions (XML, parsing, validation)
‚îÇ
‚îú‚îÄ‚îÄ‚îÄVBA/                        # VBA integration code
‚îÇ       modButtonHandlers.bas   # Button click event handlers
‚îÇ       modGlobals.bas          # Global constants and variables
‚îÇ       modUtilities.bas        # Utility functions for VBA
‚îÇ       VBA_code.bas           # Combined VBA code (all modules)
‚îÇ
‚îú‚îÄ‚îÄ‚îÄtests/                      # Unit tests
‚îÇ       test_cli.py             # CLI argument parsing tests
‚îÇ       test_helpers.py         # Helper function tests
‚îÇ
‚îú‚îÄ‚îÄ‚îÄbuild/                      # PyInstaller build artifacts (temporary)
‚îÇ
‚îî‚îÄ‚îÄ‚îÄdist/                       # PyInstaller output directory
        roadmap.exe             # Built executable (if built)
```

---

## üìÇ Expected File Structure (Base Directory)

The tool expects the following structure in your base directory:

```text
base_directory/
‚îÇ   Synth√®se_RM_CE.xlsm         # Master synthesis file (required)
‚îÇ   RM_template.xlsx             # Template file for interfaces (required)
‚îÇ   LC.xlsx                      # Temporary file (created by VBA, deleted after use)
‚îÇ   collabs.xml                  # Temporary file (created by VBA, deleted after use)
‚îÇ   pointage_output.xml          # Generated XML export (created by tool)
‚îÇ
‚îú‚îÄ‚îÄ‚îÄRM_Collaborateurs/           # Collaborator interface files (created by tool)
‚îÇ       RM_Alice.xlsx
‚îÇ       RM_Bob.xlsx
‚îÇ       RM_Charlie.xlsx
‚îÇ       ...
‚îÇ
‚îú‚îÄ‚îÄ‚îÄArchived/                    # Archive folder (created by tool)
‚îÇ       Archive_RM_Collaborateurs_01012024_120000.zip
‚îÇ       Archive_SYNTHESE_01012024_120000.xlsx
‚îÇ       ...
‚îÇ
‚îî‚îÄ‚îÄ‚îÄDeleted/                      # Deleted files folder (created by tool)
        Deleted_RM_Collaborateurs_01012024_120000.zip
        Deleted_Missing_RM_collaborators_01012024_120000.zip
        ...
```

### Required Excel File Structure

**Synth√®se_RM_CE.xlsm:**
* Must contain `Gestion_Interfaces` sheet with collaborator names in column B (starting at row 3)
* Must contain `LC` sheet with conditional list data (columns B-I, starting at row 2)
* Must contain `SYNTHESE` sheet for pointage data import

**RM_template.xlsx:**
* Must contain `POINTAGE` sheet with:
  - Cell A2: Week value (for dropdown)
  - Cell B1: Will be set to collaborator name
  - Columns D-G: Will have data validation lists added
* Must contain `LC` sheet with conditional list structure

---

## üîå VBA Integration

The tool integrates seamlessly with Excel VBA macros. The `VBA/` directory contains VBA modules that can be imported into your Excel workbook.

### VBA Modules

1. **modGlobals.bas**: Global constants and variables
   * `PYTHONEXE`: Path to Python executable or roadmap.exe
   * `GetBaseDir()`: Function to get base directory path

2. **modUtilities.bas**: Utility functions
   * `RunCommand()`: Execute shell commands
   * `CreateCollabsXML()`: Generate collaborator XML from Excel sheet
   * `CleanupGestionInterfaces()`: Remove empty rows from interface sheet
   * `ImportXMLToSheet()`: Import XML data to Excel sheet

3. **modButtonHandlers.bas**: Button click event handlers
   * `Btn_Create_RM()`: Create interfaces via button click
   * `Btn_Delete_RM()`: Delete interfaces with confirmation dialogs
   * `Btn_Collect_RM_Data()`: Import pointage data from XML to SYNTHESE sheet
   * `Btn_Clear_Synthese()`: Clear SYNTHESE sheet with archiving option
   * `Btn_Update_LC()`: Update conditional lists (LC) in template and all collaborator files
   * `Btn_Cleanup_Missing()`: Cleanup missing collaborators

### VBA Setup

1. **Import VBA modules:**
   * Open Excel workbook (`Synth√®se_RM_CE.xlsm`)
   * Press `Alt + F11` to open VBA Editor
   * Right-click on your project ‚Üí Import File
   * Import all `.bas` files from the `VBA/` directory, or import `VBA_code.bas` (combined version)

2. **Configure Python executable:**
   * Open `modGlobals.bas`
   * Update `PYTHONEXE` constant with your Python executable path:
     ```vba
     ' If using Python directly:
     Const PYTHONEXE As String = "C:\Python311\python.exe "
     
     ' If using executable:
     Const PYTHONEXE As String = "C:\path\to\roadmap.exe "
     
     ' If using uv:
     Const PYTHONEXE As String = "uv run roadmap "
     ```

3. **Create buttons/controls:**
   * In Excel, go to Developer tab ‚Üí Insert ‚Üí Button (Form Control)
   * Assign macros to buttons:
     * `Btn_Create_RM` ‚Üí "Create Interfaces"
     * `Btn_Delete_RM` ‚Üí "Delete Interfaces"
     * `Btn_Collect_RM_Data` ‚Üí "Collect Pointage Data"
     * `Btn_Clear_Synthese` ‚Üí "Clear SYNTHESE"
     * `Btn_Update_LC` ‚Üí "Update LC"
     * `Btn_Cleanup_Missing` ‚Üí "Cleanup Missing"

4. **Verify base directory:**
   * Ensure `GetBaseDir()` function returns the correct path
   * Or modify it to match your file structure

### How VBA Integration Works

1. **VBA creates temporary files:**
   * `collabs.xml`: List of collaborators from `Gestion_Interfaces` sheet
   * `LC.xlsx`: Conditional list data from `LC` sheet

2. **VBA calls Python CLI:**
   * Executes shell command with appropriate arguments
   * Waits for completion

3. **Python processes files:**
   * Reads temporary files
   * Performs operations (create, update, delete, etc.)
   * Generates output files (e.g., `pointage_output.xml`)

4. **VBA imports results:**
   * Reads `pointage_output.xml` and imports to `SYNTHESE` sheet
   * Cleans up temporary files

---

## üèóÔ∏è Building Executable

You can build a standalone executable for distribution without requiring Python installation.

### Prerequisites

* PyInstaller installed: `pip install pyinstaller` or `uv pip install pyinstaller`
* All dependencies installed

### Build Process

**Option 1: Using build script (Windows)**

```bash
build_exe.bat
```

This script:
* Builds `roadmap.exe` using PyInstaller
* Copies executable to `dist/roadmap.exe`
* Optionally copies to a predefined destination directory

**Option 2: Manual build**

```bash
pyinstaller --onefile \
    --name roadmap \
    --console \
    --clean \
    --paths . \
    --hidden-import=roadmap \
    --hidden-import=roadmap.helpers \
    --hidden-import=roadmap.main \
    --hidden-import=roadmap.roadmap \
    --hidden-import=xlwings \
    --hidden-import=openpyxl \
    --hidden-import=tqdm \
    --collect-all xlwings \
    roadmap_cli.py
```

**Output:**
* Executable: `dist/roadmap.exe`
* Size: ~50-100 MB (includes Python runtime and all dependencies)

**Usage:**
```bash
# Run executable directly
roadmap.exe create --way para

# Or with full path
C:\path\to\roadmap.exe pointage
```

**Note:** The executable is self-contained and doesn't require Python or any dependencies to be installed on the target machine.

---

## üìä Logging

All operations are logged to `.logs/roadmap.log` with the following information:

* Operation start/completion
* File counts and processing status
* Errors and warnings
* Performance metrics
* Detailed error traces

**Log format:** `%(asctime)s [%(levelname)s] %(message)s`

**Log location:**
* If running as script: `.logs/roadmap.log` in project directory
* If running as executable: `.logs/roadmap.log` next to executable
* Fallback: System temp directory if write permissions unavailable

**Log levels:**
* `DEBUG`: Detailed diagnostic information
* `INFO`: General informational messages
* `WARNING`: Warning messages (non-critical issues)
* `ERROR`: Error messages (operations failed)

---

## üèÅ Example Workflows

### Complete Setup Workflow

```bash
# 1. Update conditional lists in all files
roadmap --basedir "C:\MyRoadmapFiles" update

# 2. Create interfaces for all collaborators (parallel mode)
roadmap --basedir "C:\MyRoadmapFiles" create --way para --archive

# 3. Export pointage data
roadmap --basedir "C:\MyRoadmapFiles" pointage
```

### Regular Maintenance Workflow

```bash
# Weekly: Export time tracking data
roadmap pointage

# Monthly: Update conditional lists
roadmap update

# Quarterly: Refresh all interfaces
roadmap create --way para --archive

# Cleanup: Remove interfaces for missing collaborators
roadmap cleanup
```

### Cleanup Workflow

```bash
# Archive and delete old interfaces
roadmap delete --archive --force

# Remove interfaces for collaborators no longer in list
roadmap cleanup
```

### VBA-Driven Workflow

1. Open `Synth√®se_RM_CE.xlsm` in Excel
2. Click "Update LC" button ‚Üí Updates all conditional lists
3. Click "Create Interfaces" button ‚Üí Creates all collaborator files
4. Collaborators fill their time tracking in their individual files
5. Click "Collect Pointage Data" button ‚Üí Exports and imports all pointage data
6. Click "Clear SYNTHESE" button ‚Üí Archives and clears synthesis sheet

---

## üêõ Troubleshooting

### Common Issues

**"Required files missing" error:**
- Ensure `Synth√®se_RM_CE.xlsm` and `RM_template.xlsx` exist in base directory
- Check file names match exactly (case-sensitive on some systems)
- Verify base directory path is correct

**"Template file is opened" error:**
- Close the template Excel file before running create operations
- Check if Excel process is still running in background
- For parallel mode, ensure template file is completely closed

**"No collaborators found" error:**
- Check `collabs.xml` file exists in base directory (created by VBA)
- Verify `Gestion_Interfaces` sheet exists in synthesis file
- Ensure collaborator names are in column B starting at row 3
- Check that VBA macro `CreateCollabsXML()` ran successfully

**"LC.xlsx file not found" error:**
- Ensure VBA button `Btn_Update_LC` was clicked to generate the file
- Check that `LC` sheet exists in synthesis file
- Verify base directory path is correct

**VBA integration not working:**
- Verify Python executable path in `PYTHONEXE` constant
- Ensure base directory path is correctly set in `GetBaseDir()`
- Check that `pointage_output.xml` is generated after pointage command
- Verify VBA macros are enabled in Excel (File ‚Üí Options ‚Üí Trust Center ‚Üí Macro Settings)
- Check Windows security settings aren't blocking script execution

**Permission errors:**
- Ensure Excel files are closed before running operations
- Check file/folder permissions in base directory
- Verify you have write access to base directory and subdirectories
- On OneDrive: Ensure files are synced and not in "Files On-Demand" mode

**Parallel processing issues:**
- Ensure template file is closed
- Check available system memory (parallel mode uses more RAM)
- Reduce `max_workers` parameter if system is slow
- Fall back to `normal` mode if issues persist

**Log file not created:**
- Check write permissions in project directory or executable directory
- Verify disk space is available
- Check if antivirus is blocking file creation

---

## üìù Technical Details

### Processing Modes Comparison

| Mode | Library | Speed (51 files) | Use Case |
|------|---------|------------------|----------|
| `normal` | openpyxl | ~50s | Standard use, reliable |
| `para` | openpyxl (multiprocessing) | ~9s | Fast batch creation |
| `xlw` | xlwings | ~3min4s | VBA integration, Excel automation |

### File Handling

* **Temporary files**: `collabs.xml` and `LC.xlsx` are automatically deleted after use
* **File locking**: Tool uses temporary file approach to handle open Excel files
* **Retry logic**: Folder deletion includes retry mechanism for Windows/OneDrive locks
* **Skip patterns**: Automatically skips temporary Excel files (starting with `~$`)

### Data Validation

The tool creates Excel data validation lists for:
* **Column D**: Week selection (from POINTAGE!A2:A2)
* **Column E**: Key selection (from LC!B3:B1000)
* **Column F**: Label selection (from LC!C3:C1000)
* **Column G**: Function selection (from LC!D3:D1000)

### XML Format

Pointage XML follows this structure:
```xml
<?xml version='1.0' encoding='utf-8'?>
<rows>
  <row>
    <col1>Value for column A</col1>
    <col2>Value for column B</col2>
    ...
    <col11>Value for column K</col11>
  </row>
</rows>
```

This format is optimized for VBA parsing using `MSXML2.DOMDocument`.

---

## üîí Security Notes

* The tool reads and writes Excel files - ensure files are from trusted sources
* VBA macros require macro-enabled workbooks (`.xlsm` files)
* Executable files should be from trusted sources
* Log files may contain file paths and collaborator names - protect log files appropriately

---

## üìÑ License

MIT License - See LICENSE file for details

---

## üë§ Author

**Mustapha ELKAMILI**

---

## ü§ù Contributing

This is a project-specific tool, but suggestions and improvements are welcome. Please ensure any changes maintain compatibility with the existing VBA integration.

---

## üìö Dependencies

* **openpyxl** (>=3.1.2): Excel file manipulation
* **xlwings** (>=0.33.16): Excel automation and VBA integration
* **tqdm** (>=4.67.1): Progress bars
* **pywin32** (>=306): Windows-specific functionality
* **pyinstaller** (>=6.17.0): Executable building (optional)

---

## üîÑ Version History

* **v1.0.0**: Initial release
  * Pointage export functionality
  * Interface creation with multiple processing modes
  * LC update functionality
  * Interface deletion and archiving
  * Cleanup missing collaborators
  * VBA integration
  * Comprehensive logging
  * Executable build support

---

## üìû Support

For issues or questions:
1. Check the troubleshooting section
2. Review log files in `.logs/roadmap.log`
3. Verify file structure matches expected format
4. Ensure all prerequisites are met

---

## üéØ Future Enhancements

Potential improvements:
* Support for multiple base directories
* Configuration file for default settings
* Web interface for remote management
* Database backend for data storage
* Enhanced error recovery mechanisms
* Performance optimizations

---

**Last Updated**: 2024

* The tool skips temporary Excel files (starting with `~$`)
